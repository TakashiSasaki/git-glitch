<html>
  <head>
    <!-- <script src="https://unpkg.com/web-animations-js@2.3.1/web-animations.min.js"></script> -->
    <link rel="manifest" href="/manifest.json">
    <script src="/pwa.js"></script>
    <script src="https://unpkg.com/hammerjs@2.0.8/hammer.min.js"></script>
    <script src="https://unpkg.com/muuri@0.7.1/dist/muuri.min.js"></script>  
    <!--<script src="https://www.gstatic.com/firebasejs/5.8.5/firebase.js" ></script>-->
    <script src="/firebase-5.8.0.js" ></script>
    <script src="/firebase-config.js"></script>
    <script src="/firebase-app.js"></script>
    <link rel="stylesheet" href="/style.css" type="text/css">
  </head>
  <html>
    <div class="grid">
      <div class="item">
        <div class="item-content">
              aaab
        </div>
      </div>
      <div class="item">
        <div class="item-content">
              bbba
        </div>
      </div>
      <div class="item">
        <div class="item-content">
              123
        </div>
      </div>
      <div class="item">
        <div class="item-content">
              456
        </div>
      </div>
    </div>
    <textarea>aaa</textarea>
    <script>
      function loadDocument(url, callback){
        var xhr = new XMLHttpRequest();
        xhr.open("GET", url);
        xhr.responseType = "document";
        xhr.send();
        xhr.onload = ()=>{callback(xhr.responseXML)};
      }//loadDocument
    </script>
    <script>
      var textarea = document.getElementsByTagName("textarea")[0];
      var grid = new Muuri(".grid" , {
        dragEnabled: true, 
        dragSortInterval: 70,
        sortData: {
          default: (item, element) => {
            if(element.id) {
              return window.localStorage.getItem(element.id);
            }//if
          }//default
        }
      });
      grid.on("layoutEnd", function(items){
        for(i in items){
          var element = items[i].getElement();
          if(element.id) {
            console.log(element.id);
          }
        }
        //textarea.value += x;
      });
      
      loadDocument("/firebase-signin-button.html", (d)=>{
        firebase.auth().onAuthStateChanged((x)=>{
          if(x){
            d.getElementById("displayName").value = x.displayName;
            d.getElementById("email").value = x.email;
            x.getIdToken().then((idToken)=>{
              d.getElementById("idToken").value = idToken;
              grid.add(d.getElementsByTagName("div")[0]);
            },(error)=>{
              d.getElementById("idToken").value = error;
              grid.add(d.getElementsByTagName("div")[0]);              
            });
          }//if
        });
      });
    </script>
    <script>
      
      console.log("currentUser = " +ã€€firebase.auth().currentUser);
    </script>
    
  </html>
</html>
