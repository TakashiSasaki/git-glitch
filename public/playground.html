<html>
  <head>
    <title>microdata-rdf-streaming-parser playground</title>
    <script src="https://microdata-rdf-streaming-parser.glitch.me/microdata-rdf-streaming-parser.webpack.js"></script>
    <script src="https://rdfa-streaming-parser.glitch.me/rdfa-streaming-parser.webpack.js"></script>
    <style>
      textarea {
        width: 99%;
        height: 10em;
      }
      #inputSection {
        background-color: #eefeef;
        margin: 0px;
        padding: 1px;
      }
      #outputSection {
        background-color: #ffeeff;
        margin: 0px;
        padding: 1px;
      }
      body {
        margin: 0px;
        padding: 0px;
      }
      h1 {
        margin: 0px;
        padding-left: 0.5em;
        font-size: 1.5em;
      }
      label:not([for]) {
        display: flex;
      }
      label:not([for]) input:not([type]),
      label:not([for]) input[type=""],
      label:not([for]) input[type="text"],
      label:not([for]) select {
        display: flex;
        margin-top: 0.2em;
        margin-bottom: 0.2em;
        margin-left: 0.5em;
        width: 99%;
      }
      footer {
        background-color: #deffff;
        border-top: 1px solid #888888;
      }
      #outputDiv,
      #outputDiv2 {
        display: none;
      }
      #microdataRadioInput:checked ~ #outputDiv {
        display: block;
      }
      #rdfaRadioInput:checked ~ #outputDiv2 {
        display: block;
      }
      pre {
        padding-top: 0.2em;
        padding-bottom: 0.2em;
        padding-left: 0.2em;
        border: 1px solid #666666;
      }
    </style>
  </head>
  <body>
    <section id="inputSection">
      <h1>input</h1>
      <div>
        <label
          >Any URLðŸ‘‰<input id="urlInput" placeholder="type any URL"
        /></label>
      </div>
      <script type="module">
        const urlInput = document.getElementById("urlInput");
        urlInput.addEventListener("change", (changeEvent) => {
          const value = changeEvent.target.value;
          const inputTextarea = document.querySelector("#inputTextarea");
          urlInput.value = value;
          fetch(value)
            .then((response) => response.text())
            .then((text) => {
              inputTextarea.value = text;
              inputTextarea.dispatchEvent(new Event("input"), {
                bubbles: true,
                cancellable: true,
              });
            });
        });
      </script>
      <div>
        <label
          >example URLsðŸ‘‰
          <select>
            <option value="">or choose example URL</option>
            <option value="./microdata-example1.html">
              microdata-example1.html
            </option>
            <option value="./microdata-example2.html">
              microdata-example2.html
            </option>
            <option value="./microdata-example3.html">
              microdata-example3.html
            </option>
            <option value="./rdfa-example1.html">rdfa-example1.html</option>
            <option value="./rdfa-example2.html">rdfa-example2.html</option>
            <option value="./rdfa-example3.html">rdfa-example3.html</option>
          </select></label
        >
      </div>
      <script type="module">
        const select = document.querySelector("select");
        select.addEventListener("change", (changeEvent) => {
          const urlInput = document.querySelector("#urlInput");
          urlInput.value = changeEvent.target.value;
          urlInput.dispatchEvent(new Event("change"));
        });
      </script>
      <label for="inputTextarea">Read contentðŸ‘‡</label>
      <textarea
        id="inputTextarea"
        placeholder="HTML code with microdata here."
      ></textarea>
      <script type="module">
        const inputTextarea = document.querySelector("#inputTextarea");
        inputTextarea.addEventListener(
          "input",
          debounce((inputEvent) => {
            document.getElementById("outputDiv").innerHTML = "";
            addResult(inputEvent);

            const parser = new MicrodataRdfParser();
            parser.on("data", (x) => addResult(x));
            parser.on("error", (x) => addResult(x));
            parser.on("end", (x) => addResult(x));
            parser.write(inputTextarea.value);
          }, 500)
        );

        function addResult(o) {
          const outputDiv = document.querySelector("#outputDiv");
          const pre = document.createElement("pre");
          const code = document.createElement("code");
          pre.appendChild(code);
          code.innerText = JSON.stringify(o, null, 2);
          outputDiv.appendChild(pre);
          if (o instanceof Event) {
            pre.style.borderStyle = "dotted";
          }
        } //addResult
      </script>
      <script type="module">
        const inputTextarea = document.querySelector("#inputTextarea");

        inputTextarea.addEventListener(
          "input",
          debounce((inputEvent) => {
            document.getElementById("outputDiv2").innerHTML = "";
            addResult(inputEvent);

            const parser = new RdfaParser();
            parser.on("data", (x) => addResult(x));
            parser.on("error", (x) => addResult(x));
            parser.on("end", (x) => addResult(x));
            parser.write(inputTextarea.value);
          }, 500)
        );

        function addResult(o) {
          console.log(o);
          const outputDiv2 = document.getElementById("outputDiv2");
          const pre = document.createElement("pre");
          const code = document.createElement("code");
          pre.appendChild(code);
          code.innerText = JSON.stringify(o, null, 2);
          outputDiv2.appendChild(pre);
          if (o instanceof Event) {
            pre.style.borderStyle = "dotted";
          }
        } //addResult
      </script>
      <script src="./debounce.js"></script>
    </section>

    <section id="outputSection">
      <h1>output</h1>

      <label for="microdataRadioInput">Parse as Microdata</label
      ><input id="microdataRadioInput" type="radio" name="parser" checked />
      <label for="rdfaRadioInput">Parse as RDFa</label
      ><input id="rdfaRadioInput" type="radio" name="parser" />

      <div id="outputDiv">outputDiv</div>
      <div id="outputDiv2">outputDiv2</div>
    </section>
    <footer>
      <h1>about this code and me</h1>
      <a href="https://glitch.com/edit/#!/microdata-rdf-streaming-parser"
        >Code in Glitch</a
      >
      <a href="https://twitter.com/TakashiSasaki">Takashi Sasaki</a>
    </footer>
  </body>
</html>
