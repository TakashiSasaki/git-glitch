<html>
  <head>
    <title>microdata-rdf-streaming-parser playground</title>
    <script src="https://microdata-rdf-streaming-parser.glitch.me/microdata-rdf-streaming-parser.webpack.js"></script>
    <style>
      textarea {
        width: 99.99%;
        height: 10em;
      }
      #inputSection {
        background-color: #eefeef;
        margin: 0px;
        padding: 1px;
      }
      #outputSection {
        background-color: #ffeeff;
        margin: 0px;
        padding: 1px;
      }
      body {
        margin: 0px;
        padding: 0px;
      }
      h1 {
        margin: 0px;
        padding-left: 0.5em;
        font-size: 1.5em;
      }
      label input[type=""],
      label input[type="text"],
      label select {
        display: flex;
        margin-top: 0.2em;
        margin-bottom: 0.2em;
        margin-left: 0.5em;
        width: 99.99%;
      }
      footer {
        background-color: #deffff;
        border-top: 1px solid #888888;
      }
      #outputDiv, #ourputDiv2 {
        display:none;
      }
      #microdataRadioInput:checked ~ #outputDiv {
        display:block;
      }
      #rdfaRadioRadioInput:checked ~ #outputDiv2 {
        display: block;
      }
      
    </style>
  </head>
  <body>
    <section id="inputSection">
      <h1>input</h1>
      <div>
        <label
          >Any URLðŸ‘‰<input id="urlInput" placeholder="type any URL"
        /></label>
      </div>
      <script type="module">
        const urlInput = document.getElementById("urlInput");
        urlInput.addEventListener("change", (changeEvent) => {
          const value = changeEvent.target.value;
          const inputTextarea = document.querySelector("#inputTextarea");
          urlInput.value = value;
          fetch(value)
            .then((response) => response.text())
            .then((text) => {
              inputTextarea.value = text;
              inputTextarea.dispatchEvent(new Event("input"), {
                bubbles: true,
                cancellable: true,
              });
            });
        });
      </script>
      <div>
        <label
          >example URLsðŸ‘‰
          <select>
            <option value="">or choose example URL</option>
            <option value="./example1.html">example1.html</option>
            <option value="./example2.html">example2.html</option>
            <option value="./example3.html">example3.html</option>
          </select></label
        >
      </div>
      <script type="module">
        const select = document.querySelector("select");
        select.addEventListener("change", (changeEvent) => {
          const urlInput = document.querySelector("#urlInput");
          urlInput.value = changeEvent.target.value;
          urlInput.dispatchEvent(new Event("change"));
        });
      </script>
      <label for="inputTextarea">Read contentðŸ‘‡</label>
      <textarea
        id="inputTextarea"
        placeholder="HTML code with microdata here."
      ></textarea>
      <script type="module">
        const inputTextarea = document.querySelector("#inputTextarea");

        inputTextarea.addEventListener(
          "input",
          debounce((inputEvent) => {
            outputDiv.innerHTML = "";
            addResult(inputEvent);

            const parser = new MicrodataRdfParser();
            parser.on("data", (x) => addResult(x));
            parser.on("error", (x) => addResult(x));
            parser.on("end", (x) => addResult(x));
            parser.write(inputTextarea.value);
          }, 500)
        );

        function addResult(o) {
          const outputDiv = document.querySelector("#outputDiv");
          const pre = document.createElement("pre");
          const code = document.createElement("code");
          pre.appendChild(code);
          code.innerText = JSON.stringify(o, null, 2);
          outputDiv.appendChild(pre);
        } //addResult

        function debounce(func, wait) {
          let timeout;
          return function executedFunction(...args) {
            const later = () => {
              clearTimeout(timeout);
              func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
          };
        }
      </script>
    </section>

    <section id="outputSection">
      <h1>output</h1>
      <div>
        <label><input id="microdataRadioInput" type="radio" name="parser" />as Microdata</label>
        <label><input id="rdfaRadioInput" type="radio" name="parser" />as RDFa</label>
      </div>
      <div id="outputDiv"></div>
      <div id="outputDiv2"></div>
    </section>
    <footer>
      <h1>about this code and me</h1>
      <a href="https://glitch.com/edit/#!/microdata-rdf-streaming-parser"
        >Code in Glitch</a
      >
      <a href="https://twitter.com/TakashiSasaki">Takashi Sasaki</a>
    </footer>
  </body>
</html>
