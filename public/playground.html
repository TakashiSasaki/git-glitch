<html>
  <head>
    <title>microdata-rdf-streaming-parser playground</title>
    <script src="https://microdata-rdf-streaming-parser.glitch.me/microdata-rdf-streaming-parser.webpack.js"></script>
    <style>
      textarea {
        width: 90%;
        height: 10em;
      }
    </style>
  </head>
  <body>
    <textarea id="inputTextarea"></textarea>
    <div id="outputDiv"></div>
    <script type="module">
      const inputTextarea = document.querySelector("#inputTextarea");
      const outputDiv = document.querySelector("#outputDiv");

      inputTextarea.addEventListener("change", debounce(changeEvent) => {
        outputDiv.innerHTML = "";
        const p = document.createElement("p");
        p.innerText = " ----------- ";
        outputDiv.appendChild(p);

        const parser = new MicrodataRdfParser();
        parser.on("data", (x) => {
          const p = document.createElement("p");
          p.innerText = JSON.stringify(x, null, 2);
          outputDiv.appendChild(p);
        });
        parser.on("error", (x) => {
          const p = document.createElement("p");
          p.innerText = JSON.stringify(x, null, 2);
          outputDiv.appendChild(p);
        });
        parser.on("end", (x) => {
          p.innerText = JSON.stringify(x, null, 2);
          outputDiv.appendChild(p);
        });
        parser.write(inputTextarea.value);
      });

      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }
    </script>
  </body>
</html>
